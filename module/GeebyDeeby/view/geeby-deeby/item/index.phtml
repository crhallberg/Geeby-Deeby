<?
    $title = $this->fixtitle($item['Item_Name']);
    $this->headTitle('Item - ' . $title . ' - ');
?>
<h1><?=$this->escapeHtml($title)?></h1>

<? if (count($images) > 0): ?>
  <? foreach ($images as $image): ?>
    <table class="image">
      <tr><td align="center"><a target="_new" href="<?=$this->escapeHtml($image['Image_Path'])?>"><img src="<?=$this->escapeHtml($image['Thumb_Path'])?>" /></a></td></tr>
      <? if (!empty($image['Note'])): ?>
        <tr><td align="center">(<?=$this->escapeHtml($image['Note'])?>)</td></tr>
      <? endif; ?>
    </table>
  <? endforeach; ?>
  <div style="clear: left;"><!-- empty --></div>
<? endif; ?>

<table class="item">
  <? if (count($series) > 0): ?>
    <tr>
      <th>Series:</th>
      <td>
        <? foreach ($series as $current): ?>
          <a href="<?=$this->url('series', array('id' => $current['Series_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Series_Name']))?>
          </a>
          <? if ($current['Position'] > 0): ?>
            #<?=$this->escapeHtml($current['Position'])?>
          <? endif; ?>
          <br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>
  <? $altTitleCount = count($altTitles); if ($altTitleCount > 0): ?>
    <tr>
      <th>Alternate Title<?=$altTitleCount > 1 ? 's' : ''?>:</th>
      <td>
        <? foreach ($altTitles as $altTitle): ?>
          <?=$this->escapeHtml($this->fixtitle($altTitle['Item_AltName']))?>
          <? if (!empty($altTitle['Note'])): ?>(<?=$this->escapeHtml($altTitle['Note'])?>)<? endif; ?>
          <br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? $platformCount = count($platforms); if ($platformCount > 0): ?>
    <tr>
      <th>Platform<?=$platformCount > 1 ? 's' : ''?>:</th>
      <td>
        <? foreach ($platforms as $platform): ?>
          <a href="<?=$this->url('platform', array('id' => $platform['Platform_ID']))?>"><?=$this->escapeHtml($platform['Platform'])?></a><br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($containedIn) > 0): ?>
    <tr>
      <th>Contained In:</th>
      <td>
        <? foreach ($containedIn as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Material_Type_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($contains) > 0): ?>
    <tr>
      <th>Contains:</th>
      <td>
        <? foreach ($contains as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Material_Type_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($translatedFrom) > 0): ?>
    <tr>
      <th>Translated From:</th>
      <td>
        <? foreach ($translatedFrom as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Language_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($translatedInto) > 0): ?>
    <tr>
      <th>Translated Into:</th>
      <td>
        <? foreach ($translatedInto as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Language_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($adaptedFrom) > 0): ?>
    <tr>
      <th>Adapted From:</th>
      <td>
        <? foreach ($adaptedFrom as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Material_Type_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (count($adaptedInto) > 0): ?>
    <tr>
      <th>Adapted Into:</th>
      <td>
        <? foreach ($adaptedInto as $current): ?>
          <a href="<?=$this->url('item', array('id' => $current['Item_ID']))?>">
            <?=$this->escapeHtml($this->fixtitle($current['Item_Name']))?>
          </a> (<?=$this->escapeHtml($current['Material_Type_Name'])?>)<br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <?
    if (count($credits) > 0) {
      $groupedCredits = array();
      foreach ($credits as $credit) {
        if (!isset($groupedCredits[$credit['Role_Name']])) {
          $groupedCredits[$credit['Role_Name']] = array();
        }
        $groupedCredits[$credit['Role_Name']][] = $credit;
      }
    } else {
      $groupedCredits = array();
    }
  ?>

  <? if (count($groupedCredits) > 0): ?>
    <? foreach ($groupedCredits as $role => $group): ?>
      <tr>
        <th><?=$this->escapeHtml($role) . (count($group) == 1 ? '' : 's') ?>:</th>
        <td>
          <? foreach ($group as $credit): ?>
            <a href="<?=$this->url('person', array('id' => $credit['Person_ID']))?>">
              <?=$this->showperson($credit)?>
            </a>
            <? $realNameCount = count($this->realNames[$credit['Person_ID']]); if ($realNameCount > 0): ?>
              (pseudonym used by <?=$realNameCount == 1 ? '<a href="' . $this->url('person', array('id' => $this->realNames[$credit['Person_ID']][0]['Person_ID'])) . '">' . $this->showperson($this->realNames[$credit['Person_ID']][0]) . '</a>' : 'multiple people' ?>)
            <? endif; ?>
            <? if (!empty($credit['Note'])): ?> (<?=$this->escapeHtml($credit['Note'])?>)<? endif; ?>
            <br />
          <? endforeach; ?>
        </td>
      </tr>
    <? endforeach; ?>
  <? endif; ?>

  <? $dateCount = count($dates); if ($dateCount > 0): ?>
    <tr>
      <th>Release Date<?=$dateCount > 1 ? 's' : ''?>:</th>
      <td>
        <? foreach ($dates as $date): ?>
          <?=$this->escapeHtml($this->formatReleaseDate($date))?><br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? $isbnCount = count($isbns); if ($isbnCount > 0): ?>
    <tr>
      <th>ISBN<?=$isbnCount > 1 ? 's' : ''?>:</th>
      <td>
        <? foreach ($isbns as $isbn): ?>
          <a href="<?=$this->url('item', array('id' => $item['Item_ID'], 'action' => 'ISBNDetails', 'extra' => $isbn['ISBN13']))?>">
            <?=empty($isbn['ISBN']) ? '' : $this->escapeHtml($isbn['ISBN']) . ' / '?>
            <?=$this->escapeHtml($isbn['ISBN13'])?>
          </a>
          <?=!empty($isbn['Note']) ? '(' . $this->escapeHtml($isbn['Note']) . ')' : ''?>
          <br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? $codeCount = count($codes); if ($codeCount > 0): ?>
    <tr>
      <th>Product Code<?=$codeCount > 1 ? 's' : ''?>:</th>
      <td>
        <? foreach ($codes as $code): ?>
          <?=$this->escapeHtml($code['Product_Code'])?>
          <?=!empty($code['Note']) ? '(' . $this->escapeHtml($code['Note']) . ')' : ''?>
          <br />
        <? endforeach; ?>
      </td>
    </tr>
  <? endif; ?>

  <? if (!empty($item['Item_Length'])): ?>
    <tr><th>Length:</th><td><?=$this->escapeHtml($item['Item_Length'])?></td></tr>
  <? endif; ?>

  <? if (!empty($item['Item_Endings'])): ?>
    <tr><th>Number of Endings:</th><td><?=$this->escapeHtml($item['Item_Endings'])?></td></tr>
  <? endif; ?>
</table>